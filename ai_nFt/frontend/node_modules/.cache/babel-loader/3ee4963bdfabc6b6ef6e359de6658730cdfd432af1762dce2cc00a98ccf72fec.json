{"ast":null,"code":"import { BaseSignerWalletAdapter, WalletAccountError, WalletConfigError, WalletDisconnectedError, WalletDisconnectionError, WalletLoadError, WalletNotConnectedError, WalletNotReadyError, WalletPublicKeyError, WalletReadyState, WalletSignTransactionError, isVersionedTransaction } from '@solana/wallet-adapter-base';\nimport { PublicKey } from '@solana/web3.js';\nimport './polyfills/index.js';\nexport const TrezorWalletName = 'Trezor';\nexport class TrezorWalletAdapter extends BaseSignerWalletAdapter {\n  constructor(config = {}) {\n    super();\n    this.name = TrezorWalletName;\n    this.url = 'https://trezor.io';\n    this.icon = 'data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjEwOCIgd2lkdGg9IjEwOCIgdmlld0JveD0iMCAwIDEwOCAxMDgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0ibTU0IDBjMjkuODI0MjE5IDAgNTQgMjQuMTc1NzgxIDU0IDU0cy0yNC4xNzU3ODEgNTQtNTQgNTQtNTQtMjQuMTc1NzgxLTU0LTU0IDI0LjE3NTc4MS01NCA1NC01NHptMCAwIiBmaWxsPSIjZmZmIi8+PHBhdGggZD0ibTU0LjA0Njg3NSAxMC4xMjVjLTEyLjEwNTQ2OSAwLTIxLjkwNjI1IDEwLjExNzE4OC0yMS45MDYyNSAyMi42MTcxODh2OC40NzY1NjJjLTQuMjUuNzk2ODc1LTguNTE1NjI1IDEuODU1NDY5LTguNTE1NjI1IDMuMjMwNDY5djQ0LjIzODI4MXMwIDEuMjIyNjU2IDEuMzMyMDMxIDEuODAwNzgxYzQuODI0MjE5IDIuMDE5NTMxIDIzLjgxMjUgOC45NTcwMzEgMjguMTc1NzgxIDEwLjU0Njg3NS41NjI1LjIxNDg0NC43MTg3NS4yMTQ4NDQuODY3MTg4LjIxNDg0NC4yMDcwMzEgMCAuMzA0Njg4IDAgLjg2NzE4OC0uMjE0ODQ0IDQuMzYzMjgxLTEuNTg5ODQ0IDIzLjM5ODQzNy04LjUyNzM0NCAyOC4yMjY1NjItMTAuNTQ2ODc1IDEuMjM0Mzc1LS41MjczNDMgMS4yODEyNS0xLjc1IDEuMjgxMjUtMS43NXYtNDQuMjg5MDYyYzAtMS4zNzUtNC4yMDMxMjUtMi40ODQzNzUtOC40Njg3NS0zLjIzMDQ2OXYtOC40NzY1NjJjLjA2MjUtMTIuNS05Ljc5Njg3NS0yMi42MTcxODgtMjEuODU5Mzc1LTIyLjYxNzE4OHptMCAxMC44MDg1OTRjNy4xMzY3MTkgMCAxMS40NDkyMTkgNC40NTMxMjUgMTEuNDQ5MjE5IDExLjgyMDMxMnY3LjM2NzE4OGMtOC0uNTc4MTI1LTE0LjgzMjAzMi0uNTc4MTI1LTIyLjg4MjgxMyAwdi03LjM2NzE4OGMwLTcuMzc4OTA2IDQuMzEyNS0xMS44MjAzMTIgMTEuNDMzNTk0LTExLjgyMDMxMnptLS4wNDY4NzUgMzAuMDM1MTU2YzkuOTU3MDMxIDAgMTguMzE2NDA2Ljc5Njg3NSAxOC4zMTY0MDYgMi4yMjI2NTZ2MjcuNTk3NjU2YzAgLjQyOTY4OC0uMDUwNzgxLjQ4MDQ2OS0uNDE3OTY4LjYzMjgxMy0uMzUxNTYzLjE2NDA2My0xNi45ODA0NjkgNi4zNTU0NjktMTYuOTgwNDY5IDYuMzU1NDY5cy0uNjcxODc1LjIxNDg0NC0uODcxMDk0LjIxNDg0NGMtLjIwNzAzMSAwLS44NjcxODctLjI2NTYyNi0uODY3MTg3LS4yNjU2MjZzLTE2LjYyODkwNy02LjE5MTQwNi0xNi45ODA0NjktNi4zNTU0NjhjLS4zNTU0NjktLjE2NDA2My0uNDE3OTY5LS4yMTQ4NDQtLjQxNzk2OS0uNjMyODEzdi0yNy41OTc2NTZjLS4wOTc2NTYtMS40MjU3ODEgOC4yNjE3MTktMi4xNzE4NzUgMTguMjE4NzUtMi4xNzE4NzV6bTAgMCIvPjwvc3ZnPg==';\n    this.supportedTransactionVersions = new Set(['legacy', 0]);\n    this._readyState = typeof window === 'undefined' || typeof document === 'undefined' ? WalletReadyState.Unsupported : WalletReadyState.Loadable;\n    this._onDeviceEvent = event => {\n      if (event.type === 'device-disconnect') {\n        this._disconnected();\n      }\n    };\n    this._disconnected = async () => {\n      const wallet = this._wallet;\n      if (wallet) {\n        this._wallet = null;\n        this._publicKey = null;\n        try {\n          wallet.off('DEVICE_EVENT', this._onDeviceEvent);\n          wallet.dispose();\n        } catch (error) {\n          this.emit('error', new WalletDisconnectionError(error?.message, error));\n        }\n        this.emit('error', new WalletDisconnectedError());\n        this.emit('disconnect');\n      }\n    };\n    this._derivationPath = config.derivationPath || `m/44'/501'/0'/0'`;\n    this._wallet = null;\n    this._connectUrl = config.connectUrl?.replace(/\\/*$/, '/');\n    this._connecting = false;\n    this._publicKey = null;\n  }\n  get publicKey() {\n    return this._publicKey;\n  }\n  get connecting() {\n    return this._connecting;\n  }\n  get readyState() {\n    return this._readyState;\n  }\n  async connect() {\n    try {\n      if (this.connected || this.connecting) return;\n      if (this._readyState !== WalletReadyState.Loadable) throw new WalletNotReadyError();\n      this._connecting = true;\n      let wallet;\n      try {\n        const {\n          default: TrezorConnect\n        } = await import('@trezor/connect-web');\n        // @ts-expect-error // HACK: TrezorConnect.default is undefined.\n        wallet = TrezorConnect.default;\n      } catch (error) {\n        throw new WalletLoadError(error?.message, error);\n      }\n      try {\n        await wallet.init({\n          manifest: {\n            email: 'gabriel.kerekes@vacuumlabs.com',\n            appUrl: window.location.href\n          },\n          lazyLoad: true,\n          ...(this._connectUrl ? {\n            connectSrc: this._connectUrl,\n            iframeSrc: this._connectUrl\n          } : {})\n        });\n      } catch (error) {\n        throw new WalletConfigError(error?.message, error);\n      }\n      let result;\n      try {\n        result = await wallet.solanaGetPublicKey({\n          path: this._derivationPath\n        });\n      } catch (error) {\n        throw new WalletAccountError(error?.message, error);\n      }\n      if (!result.success) {\n        throw new WalletAccountError(result.payload?.error, result.payload);\n      }\n      let publicKey;\n      try {\n        publicKey = new PublicKey(Buffer.from(result.payload.publicKey, 'hex'));\n      } catch (error) {\n        throw new WalletPublicKeyError(error?.message, error);\n      }\n      wallet.on('DEVICE_EVENT', this._onDeviceEvent);\n      this._wallet = wallet;\n      this._publicKey = publicKey;\n      this.emit('connect', publicKey);\n    } catch (error) {\n      this.emit('error', error);\n      throw error;\n    } finally {\n      this._connecting = false;\n    }\n  }\n  async disconnect() {\n    const wallet = this._wallet;\n    if (wallet) {\n      this._wallet = null;\n      this._publicKey = null;\n      try {\n        wallet.off('DEVICE_EVENT', this._onDeviceEvent);\n        await wallet.dispose();\n      } catch (error) {\n        this.emit('error', new WalletDisconnectionError(error?.message, error));\n      }\n      this.emit('disconnect');\n    }\n  }\n  async signTransaction(transaction) {\n    try {\n      const wallet = this._wallet;\n      const publicKey = this._publicKey;\n      if (!wallet || !publicKey) throw new WalletNotConnectedError();\n      const serializedTransaction = isVersionedTransaction(transaction) ? transaction.message.serialize() : transaction.serializeMessage();\n      let result;\n      try {\n        result = await wallet.solanaSignTransaction({\n          path: this._derivationPath,\n          serializedTx: Buffer.from(serializedTransaction).toString('hex')\n        });\n      } catch (error) {\n        throw new WalletSignTransactionError(error?.message, error);\n      }\n      if (!result.success) {\n        throw new WalletSignTransactionError(result.payload?.error, result.payload);\n      }\n      try {\n        const signature = Buffer.from(result.payload.signature, 'hex');\n        transaction.addSignature(publicKey, signature);\n      } catch (error) {\n        throw new WalletSignTransactionError(error?.message, error);\n      }\n      return transaction;\n    } catch (error) {\n      this.emit('error', error);\n      throw error;\n    }\n  }\n}\n//# sourceMappingURL=adapter.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}