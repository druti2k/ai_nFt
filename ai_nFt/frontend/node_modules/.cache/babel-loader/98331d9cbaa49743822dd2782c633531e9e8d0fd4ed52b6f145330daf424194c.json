{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getNewAccountLenForExtensionLen = exports.getAccountLenForMint = exports.getExtensionTypes = exports.getExtensionData = exports.getAccountLen = exports.getMintLen = exports.getAccountTypeOfMintType = exports.isAccountExtension = exports.isMintExtension = exports.getTypeLen = exports.LENGTH_SIZE = exports.TYPE_SIZE = exports.ExtensionType = void 0;\nconst account_js_1 = require(\"../state/account.js\");\nconst mint_js_1 = require(\"../state/mint.js\");\nconst multisig_js_1 = require(\"../state/multisig.js\");\nconst accountType_js_1 = require(\"./accountType.js\");\nconst index_js_1 = require(\"./cpiGuard/index.js\");\nconst index_js_2 = require(\"./defaultAccountState/index.js\");\nconst immutableOwner_js_1 = require(\"./immutableOwner.js\");\nconst state_js_1 = require(\"./interestBearingMint/state.js\");\nconst index_js_3 = require(\"./memoTransfer/index.js\");\nconst state_js_2 = require(\"./metadataPointer/state.js\");\nconst mintCloseAuthority_js_1 = require(\"./mintCloseAuthority.js\");\nconst nonTransferable_js_1 = require(\"./nonTransferable.js\");\nconst permanentDelegate_js_1 = require(\"./permanentDelegate.js\");\nconst index_js_4 = require(\"./transferFee/index.js\");\nconst index_js_5 = require(\"./transferHook/index.js\");\nconst constants_js_1 = require(\"../constants.js\");\n// Sequence from https://github.com/solana-labs/solana-program-library/blob/master/token/program-2022/src/extension/mod.rs#L903\nvar ExtensionType;\n(function (ExtensionType) {\n  ExtensionType[ExtensionType[\"Uninitialized\"] = 0] = \"Uninitialized\";\n  ExtensionType[ExtensionType[\"TransferFeeConfig\"] = 1] = \"TransferFeeConfig\";\n  ExtensionType[ExtensionType[\"TransferFeeAmount\"] = 2] = \"TransferFeeAmount\";\n  ExtensionType[ExtensionType[\"MintCloseAuthority\"] = 3] = \"MintCloseAuthority\";\n  ExtensionType[ExtensionType[\"ConfidentialTransferMint\"] = 4] = \"ConfidentialTransferMint\";\n  ExtensionType[ExtensionType[\"ConfidentialTransferAccount\"] = 5] = \"ConfidentialTransferAccount\";\n  ExtensionType[ExtensionType[\"DefaultAccountState\"] = 6] = \"DefaultAccountState\";\n  ExtensionType[ExtensionType[\"ImmutableOwner\"] = 7] = \"ImmutableOwner\";\n  ExtensionType[ExtensionType[\"MemoTransfer\"] = 8] = \"MemoTransfer\";\n  ExtensionType[ExtensionType[\"NonTransferable\"] = 9] = \"NonTransferable\";\n  ExtensionType[ExtensionType[\"InterestBearingConfig\"] = 10] = \"InterestBearingConfig\";\n  ExtensionType[ExtensionType[\"CpiGuard\"] = 11] = \"CpiGuard\";\n  ExtensionType[ExtensionType[\"PermanentDelegate\"] = 12] = \"PermanentDelegate\";\n  ExtensionType[ExtensionType[\"NonTransferableAccount\"] = 13] = \"NonTransferableAccount\";\n  ExtensionType[ExtensionType[\"TransferHook\"] = 14] = \"TransferHook\";\n  ExtensionType[ExtensionType[\"TransferHookAccount\"] = 15] = \"TransferHookAccount\";\n  // ConfidentialTransferFee, // Not implemented yet\n  // ConfidentialTransferFeeAmount, // Not implemented yet\n  ExtensionType[ExtensionType[\"MetadataPointer\"] = 18] = \"MetadataPointer\";\n  ExtensionType[ExtensionType[\"TokenMetadata\"] = 19] = \"TokenMetadata\";\n})(ExtensionType || (exports.ExtensionType = ExtensionType = {}));\nexports.TYPE_SIZE = 2;\nexports.LENGTH_SIZE = 2;\nfunction addTypeAndLengthToLen(len) {\n  return len + exports.TYPE_SIZE + exports.LENGTH_SIZE;\n}\nfunction isVariableLengthExtension(e) {\n  switch (e) {\n    case ExtensionType.TokenMetadata:\n      return true;\n    default:\n      return false;\n  }\n}\n// NOTE: All of these should eventually use their type's Span instead of these\n// constants.  This is provided for at least creation to work.\nfunction getTypeLen(e) {\n  switch (e) {\n    case ExtensionType.Uninitialized:\n      return 0;\n    case ExtensionType.TransferFeeConfig:\n      return index_js_4.TRANSFER_FEE_CONFIG_SIZE;\n    case ExtensionType.TransferFeeAmount:\n      return index_js_4.TRANSFER_FEE_AMOUNT_SIZE;\n    case ExtensionType.MintCloseAuthority:\n      return mintCloseAuthority_js_1.MINT_CLOSE_AUTHORITY_SIZE;\n    case ExtensionType.ConfidentialTransferMint:\n      return 97;\n    case ExtensionType.ConfidentialTransferAccount:\n      return 286;\n    case ExtensionType.CpiGuard:\n      return index_js_1.CPI_GUARD_SIZE;\n    case ExtensionType.DefaultAccountState:\n      return index_js_2.DEFAULT_ACCOUNT_STATE_SIZE;\n    case ExtensionType.ImmutableOwner:\n      return immutableOwner_js_1.IMMUTABLE_OWNER_SIZE;\n    case ExtensionType.MemoTransfer:\n      return index_js_3.MEMO_TRANSFER_SIZE;\n    case ExtensionType.MetadataPointer:\n      return state_js_2.METADATA_POINTER_SIZE;\n    case ExtensionType.NonTransferable:\n      return nonTransferable_js_1.NON_TRANSFERABLE_SIZE;\n    case ExtensionType.InterestBearingConfig:\n      return state_js_1.INTEREST_BEARING_MINT_CONFIG_STATE_SIZE;\n    case ExtensionType.PermanentDelegate:\n      return permanentDelegate_js_1.PERMANENT_DELEGATE_SIZE;\n    case ExtensionType.NonTransferableAccount:\n      return nonTransferable_js_1.NON_TRANSFERABLE_ACCOUNT_SIZE;\n    case ExtensionType.TransferHook:\n      return index_js_5.TRANSFER_HOOK_SIZE;\n    case ExtensionType.TransferHookAccount:\n      return index_js_5.TRANSFER_HOOK_ACCOUNT_SIZE;\n    case ExtensionType.TokenMetadata:\n      throw Error(`Cannot get type length for variable extension type: ${e}`);\n    default:\n      throw Error(`Unknown extension type: ${e}`);\n  }\n}\nexports.getTypeLen = getTypeLen;\nfunction isMintExtension(e) {\n  switch (e) {\n    case ExtensionType.TransferFeeConfig:\n    case ExtensionType.MintCloseAuthority:\n    case ExtensionType.ConfidentialTransferMint:\n    case ExtensionType.DefaultAccountState:\n    case ExtensionType.NonTransferable:\n    case ExtensionType.InterestBearingConfig:\n    case ExtensionType.PermanentDelegate:\n    case ExtensionType.TransferHook:\n    case ExtensionType.MetadataPointer:\n    case ExtensionType.TokenMetadata:\n      return true;\n    case ExtensionType.Uninitialized:\n    case ExtensionType.TransferFeeAmount:\n    case ExtensionType.ConfidentialTransferAccount:\n    case ExtensionType.ImmutableOwner:\n    case ExtensionType.MemoTransfer:\n    case ExtensionType.CpiGuard:\n    case ExtensionType.NonTransferableAccount:\n    case ExtensionType.TransferHookAccount:\n      return false;\n    default:\n      throw Error(`Unknown extension type: ${e}`);\n  }\n}\nexports.isMintExtension = isMintExtension;\nfunction isAccountExtension(e) {\n  switch (e) {\n    case ExtensionType.TransferFeeAmount:\n    case ExtensionType.ConfidentialTransferAccount:\n    case ExtensionType.ImmutableOwner:\n    case ExtensionType.MemoTransfer:\n    case ExtensionType.CpiGuard:\n    case ExtensionType.NonTransferableAccount:\n    case ExtensionType.TransferHookAccount:\n      return true;\n    case ExtensionType.Uninitialized:\n    case ExtensionType.TransferFeeConfig:\n    case ExtensionType.MintCloseAuthority:\n    case ExtensionType.ConfidentialTransferMint:\n    case ExtensionType.DefaultAccountState:\n    case ExtensionType.NonTransferable:\n    case ExtensionType.InterestBearingConfig:\n    case ExtensionType.PermanentDelegate:\n    case ExtensionType.TransferHook:\n    case ExtensionType.MetadataPointer:\n    case ExtensionType.TokenMetadata:\n      return false;\n    default:\n      throw Error(`Unknown extension type: ${e}`);\n  }\n}\nexports.isAccountExtension = isAccountExtension;\nfunction getAccountTypeOfMintType(e) {\n  switch (e) {\n    case ExtensionType.TransferFeeConfig:\n      return ExtensionType.TransferFeeAmount;\n    case ExtensionType.ConfidentialTransferMint:\n      return ExtensionType.ConfidentialTransferAccount;\n    case ExtensionType.NonTransferable:\n      return ExtensionType.NonTransferableAccount;\n    case ExtensionType.TransferHook:\n      return ExtensionType.TransferHookAccount;\n    case ExtensionType.TransferFeeAmount:\n    case ExtensionType.ConfidentialTransferAccount:\n    case ExtensionType.CpiGuard:\n    case ExtensionType.DefaultAccountState:\n    case ExtensionType.ImmutableOwner:\n    case ExtensionType.MemoTransfer:\n    case ExtensionType.MintCloseAuthority:\n    case ExtensionType.MetadataPointer:\n    case ExtensionType.TokenMetadata:\n    case ExtensionType.Uninitialized:\n    case ExtensionType.InterestBearingConfig:\n    case ExtensionType.PermanentDelegate:\n    case ExtensionType.NonTransferableAccount:\n    case ExtensionType.TransferHookAccount:\n      return ExtensionType.Uninitialized;\n  }\n}\nexports.getAccountTypeOfMintType = getAccountTypeOfMintType;\nfunction getLen(extensionTypes, baseSize, variableLengthExtensions = {}) {\n  if (extensionTypes.length === 0 && Object.keys(variableLengthExtensions).length === 0) {\n    return baseSize;\n  } else {\n    const accountLength = account_js_1.ACCOUNT_SIZE + accountType_js_1.ACCOUNT_TYPE_SIZE + extensionTypes.filter((element, i) => i === extensionTypes.indexOf(element)).map(element => addTypeAndLengthToLen(getTypeLen(element))).reduce((a, b) => a + b, 0) + Object.entries(variableLengthExtensions).map(([extension, len]) => {\n      if (!isVariableLengthExtension(Number(extension))) {\n        throw Error(`Extension ${extension} is not variable length`);\n      }\n      return addTypeAndLengthToLen(len);\n    }).reduce((a, b) => a + b, 0);\n    if (accountLength === multisig_js_1.MULTISIG_SIZE) {\n      return accountLength + exports.TYPE_SIZE;\n    } else {\n      return accountLength;\n    }\n  }\n}\nfunction getMintLen(extensionTypes, variableLengthExtensions = {}) {\n  return getLen(extensionTypes, mint_js_1.MINT_SIZE, variableLengthExtensions);\n}\nexports.getMintLen = getMintLen;\nfunction getAccountLen(extensionTypes) {\n  // There are currently no variable length extensions for accounts\n  return getLen(extensionTypes, account_js_1.ACCOUNT_SIZE);\n}\nexports.getAccountLen = getAccountLen;\nfunction getExtensionData(extension, tlvData) {\n  let extensionTypeIndex = 0;\n  while (addTypeAndLengthToLen(extensionTypeIndex) <= tlvData.length) {\n    const entryType = tlvData.readUInt16LE(extensionTypeIndex);\n    const entryLength = tlvData.readUInt16LE(extensionTypeIndex + exports.TYPE_SIZE);\n    const typeIndex = addTypeAndLengthToLen(extensionTypeIndex);\n    if (entryType == extension) {\n      return tlvData.slice(typeIndex, typeIndex + entryLength);\n    }\n    extensionTypeIndex = typeIndex + entryLength;\n  }\n  return null;\n}\nexports.getExtensionData = getExtensionData;\nfunction getExtensionTypes(tlvData) {\n  const extensionTypes = [];\n  let extensionTypeIndex = 0;\n  while (extensionTypeIndex < tlvData.length) {\n    const entryType = tlvData.readUInt16LE(extensionTypeIndex);\n    extensionTypes.push(entryType);\n    const entryLength = tlvData.readUInt16LE(extensionTypeIndex + exports.TYPE_SIZE);\n    extensionTypeIndex += addTypeAndLengthToLen(entryLength);\n  }\n  return extensionTypes;\n}\nexports.getExtensionTypes = getExtensionTypes;\nfunction getAccountLenForMint(mint) {\n  const extensionTypes = getExtensionTypes(mint.tlvData);\n  const accountExtensions = extensionTypes.map(getAccountTypeOfMintType);\n  return getAccountLen(accountExtensions);\n}\nexports.getAccountLenForMint = getAccountLenForMint;\nfunction getNewAccountLenForExtensionLen(info, address, extensionType, extensionLen, programId = constants_js_1.TOKEN_2022_PROGRAM_ID) {\n  const mint = (0, mint_js_1.unpackMint)(address, info, programId);\n  const extensionData = getExtensionData(extensionType, mint.tlvData);\n  const currentExtensionLen = extensionData ? addTypeAndLengthToLen(extensionData.length) : 0;\n  const newExtensionLen = addTypeAndLengthToLen(extensionLen);\n  return info.data.length + newExtensionLen - currentExtensionLen;\n}\nexports.getNewAccountLenForExtensionLen = getNewAccountLenForExtensionLen;\n//# sourceMappingURL=extensionType.js.map","map":null,"metadata":{},"sourceType":"script","externalDependencies":[]}